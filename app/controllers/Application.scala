package controllers

import play.api.mvc._
import play.libs.WS
import play.api.libs.json._
import org.joda.time.LocalTime
import scala.util.Try


object Application extends Controller {
  
  private val metOfficeKey = "1fd60563-da77-4bb9-88d5-0444be01310f"

  private val FALLBACK_LOCATIONS_DATA =
    """{"Locations":{"Location":[{"id":"3094","latitude":"57.698","longitude":"-2.121","name":"Rosehearty Samos"},{"id":"3144","latitude":"56.326","longitude":"-3.729","name":"Strathallan"},{"id":"3166","latitude":"55.928","longitude":"-3.343","name":"Edinburgh\/Gogarbank"},{"id":"3204","latitude":"54.0849","longitude":"-4.6321","name":"Ronaldsway"},{"id":"3210","latitude":"54.518","longitude":"-3.615","name":"St. Bees Head"},{"id":"3220","latitude":"54.933","longitude":"-2.963","name":"Carlisle"},{"id":"3224","latitude":"55.05","longitude":"-2.553","name":"Spadeadam"},{"id":"3257","latitude":"54.296","longitude":"-1.53","name":"Leeming"},{"id":"3261","latitude":"54.134","longitude":"-1.414","name":"Dishforth Airfield"},{"id":"3382","latitude":"53.867","longitude":"-0.433","name":"Leconfield Sar"},{"id":"3392","latitude":"53.088","longitude":"0.274","name":"Wainfleet"},{"id":"6","latitude":"50.9561","longitude":"0.9392","name":"Lydd"},{"id":"22","latitude":"53.5797","longitude":"-0.3472","name":"Humberside Airport"},{"id":"3006","latitude":"60.447","longitude":"-1.277","name":"Sella Ness"},{"id":"3037","latitude":"57.257","longitude":"-5.809","name":"Skye\/Lusa (Samos)"},{"id":"99003","latitude":"58.167","longitude":"-4.733","name":"Cassley"},{"id":"3405","latitude":"52.789","longitude":"-4.742","name":"Aberdaron"},{"id":"3414","latitude":"52.794","longitude":"-2.663","name":"Shawbury"},{"id":"3453","latitude":"52.727","longitude":"-0.654","name":"Cottesmore"},{"id":"3482","latitude":"52.651","longitude":"0.569","name":"Marham"},{"id":"3503","latitude":"52.344","longitude":"-3.947","name":"Trawsgoed"},{"id":"3507","latitude":"52.063","longitude":"-3.614","name":"Sennybridge"},{"id":"3604","latitude":"51.708","longitude":"-5.055","name":"Milford Haven C.B."},{"id":"3628","latitude":"51.521","longitude":"-2.576","name":"Filton"},{"id":"3649","latitude":"51.758","longitude":"-1.576","name":"Brize Norton"},{"id":"3672","latitude":"51.548","longitude":"-0.415","name":"Northolt"},{"id":"3710","latitude":"51.087","longitude":"-3.608","name":"Liscombe"},{"id":"3716","latitude":"51.405","longitude":"-3.44","name":"St-Athan"},{"id":"3761","latitude":"51.238","longitude":"-0.944","name":"Odiham"},{"id":"3772","latitude":"51.479","longitude":"-0.449","name":"Heathrow"},{"id":"3797","latitude":"51.3422","longitude":"1.3461","name":"Manston"},{"id":"3827","latitude":"50.354","longitude":"-4.121","name":"Mount Batten"},{"id":"3895","latitude":"49.2079","longitude":"-2.1955","name":"Jersey"},{"id":"3916","latitude":"55.181","longitude":"-6.153","name":"Ballypatrick Forest"},{"id":"3928","latitude":"54.852","longitude":"-5.83","name":"Larne"},{"id":"310006","latitude":"52.4065","longitude":"-1.5182","name":"Coventry"},{"id":"310023","latitude":"54.1088","longitude":"-3.2175","name":"Barrow-In-Furness"},{"id":"310026","latitude":"51.3754","longitude":"-2.3585","name":"Bath"},{"id":"310034","latitude":"50.7187","longitude":"-1.8794","name":"Bournemouth"},{"id":"320313","latitude":"54.4862","longitude":"-0.6117","name":"Whitby"},{"id":"321942","latitude":"56.6218","longitude":"-3.8656","name":"Aberfeldy"},{"id":"310046","latitude":"51.7345","longitude":"0.4778","name":"Chelmsford"},{"id":"310056","latitude":"53.1001","longitude":"-2.4424","name":"Crewe"},{"id":"310069","latitude":"50.7179","longitude":"-3.5327","name":"Exeter"},{"id":"310071","latitude":"51.0809","longitude":"1.1711","name":"Folkestone"},{"id":"310103","latitude":"55.9007","longitude":"-3.5167","name":"Livingston"},{"id":"310104","latitude":"52.4807","longitude":"1.7553","name":"Lowestoft"},{"id":"310105","latitude":"51.8783","longitude":"-0.4155","name":"Luton"},{"id":"310108","latitude":"51.3892","longitude":"1.3886","name":"Margate"},{"id":"310121","latitude":"50.7139","longitude":"-1.9866","name":"Poole"},{"id":"310130","latitude":"53.3418","longitude":"-2.7283","name":"Runcorn"},{"id":"310150","latitude":"51.5556","longitude":"-1.7784","name":"Swindon"},{"id":"310170","latitude":"57.1498","longitude":"-2.0927","name":"Aberdeen"},{"id":"310191","latitude":"50.7623","longitude":"-1.2991","name":"Cowes"},{"id":"322064","latitude":"51.8157","longitude":"1.0231","name":"Brightlingsea"},{"id":"322944","latitude":"55.8881","longitude":"-4.8904","name":"Wemyss Bay"},{"id":"322951","latitude":"52.666","longitude":"0.1605","name":"Wisbech"},{"id":"322953","latitude":"54.6435","longitude":"-3.5414","name":"Workington"},{"id":"322636","latitude":"50.1686","longitude":"-5.106","name":"Penryn"},{"id":"320003","latitude":"51.0683","longitude":"-1.7931","name":"Salisbury"},{"id":"322172","latitude":"54.3446","longitude":"-7.6313","name":"Enniskillen"},{"id":"322193","latitude":"51.9936","longitude":"-4.9749","name":"Fishguard"},{"id":"322230","latitude":"55.2401","longitude":"-4.853","name":"Girvan"},{"id":"322234","latitude":"53.7027","longitude":"-0.8748","name":"Goole"},{"id":"322281","latitude":"51.5","longitude":"-0.42","name":"Hayes"},{"id":"322324","latitude":"51.45","longitude":"0.71","name":"Isle Of Grain"},{"id":"324152","latitude":"51.3775","longitude":"-0.0933","name":"Croydon"},{"id":"324153","latitude":"51.4119","longitude":"-0.2991","name":"Kingston Upon Thames"},{"id":"324157","latitude":"55.427","longitude":"-2.7795","name":"Hawick"},{"id":"324162","latitude":"52.0308","longitude":"-0.4946","name":"Ampthill"},{"id":"324166","latitude":"52.0857","longitude":"-0.2626","name":"Biggleswade"},{"id":"324173","latitude":"51.7181","longitude":"-1.9668","name":"Cirencester"},{"id":"324181","latitude":"53.2796","longitude":"-2.896","name":"Ellesmere Port"},{"id":"324185","latitude":"57.1441","longitude":"-4.6798","name":"Fort Augustus"},{"id":"324190","latitude":"57.3306","longitude":"-3.6082","name":"Grantown-On-Spey"},{"id":"324194","latitude":"52.5451","longitude":"-1.3752","name":"Hinckley"},{"id":"324198","latitude":"52.396","longitude":"-0.7287","name":"Kettering"},{"id":"324200","latitude":"55.1222","longitude":"-3.3476","name":"Lockerbie"},{"id":"324203","latitude":"52.59","longitude":"-3.8522","name":"Machynlleth"},{"id":"324215","latitude":"53.3211","longitude":"-0.9439","name":"Retford"},{"id":"324224","latitude":"52.6781","longitude":"-2.4439","name":"Telford"},{"id":"324229","latitude":"53.6831","longitude":"-1.5044","name":"Wakefield"},{"id":"324235","latitude":"53.3608","longitude":"-2.7322","name":"Widnes"},{"id":"324237","latitude":"51.9445","longitude":"-0.8772","name":"Winslow"},{"id":"324251","latitude":"52.9311","longitude":"1.3036","name":"Cromer"},{"id":"324255","latitude":"53.558","longitude":"-3.0674","name":"Formby"},{"id":"324259","latitude":"54.9828","longitude":"-2.5379","name":"Greenhead Youth Hostel"},{"id":"324262","latitude":"51.9964","longitude":"-3.8007","name":"Llandovery"},{"id":"324266","latitude":"50.9016","longitude":"-3.49","name":"Tiverton"},{"id":"324268","latitude":"51.5859","longitude":"-2.1014","name":"Malmesbury"},{"id":"322847","latitude":"54.59","longitude":"-1.15","name":"Teesport"},{"id":"324049","latitude":"54.6637","longitude":"-1.6772","name":"Bishop Auckland"},{"id":"324059","latitude":"51.7953","longitude":"-0.0796","name":"Hertford"},{"id":"324064","latitude":"54.9602","longitude":"-4.4819","name":"Newton Stewart"},{"id":"324069","latitude":"52.3252","longitude":"1.682","name":"Southwold"},{"id":"324073","latitude":"50.5506","longitude":"-4.1405","name":"Tavistock"},{"id":"324076","latitude":"58.567","longitude":"-4.75","name":"Durness"},{"id":"322372","latitude":"54.3279","longitude":"-2.7449","name":"Kendal"},{"id":"322446","latitude":"51.97","longitude":"-0.23","name":"Letchworth"},{"id":"322467","latitude":"56.54","longitude":"-5.79","name":"Lochaline"},{"id":"322494","latitude":"51.7314","longitude":"0.6731","name":"Maldon"},{"id":"322581","latitude":"52.92","longitude":"-1.08","name":"Nottingham"},{"id":"322718","latitude":"56.0365","longitude":"-3.4216","name":"Rosyth"},{"id":"322752","latitude":"60.1381","longitude":"-1.2804","name":"Scalloway"},{"id":"322757","latitude":"58.611","longitude":"-3.551","name":"Scrabster"},{"id":"322758","latitude":"54.8402","longitude":"-1.3359","name":"Seaham"},{"id":"322763","latitude":"51.72","longitude":"-2.47","name":"Sharpness"},{"id":"322774","latitude":"54.8683","longitude":"-3.3881","name":"Silloth"},{"id":"324387","latitude":"51.5077","longitude":"-0.165","name":"Hyde Park"},{"id":"99203","latitude":"51.534","longitude":"-0.0090","name":"London  Olympic Park South"},{"id":"322237","latitude":"55.9828","longitude":"-3.232","name":"Granton"},{"id":"350003","latitude":"53.0333","longitude":"-2.14","name":"Abbey Hulton"},{"id":"350007","latitude":"51.6459","longitude":"-3.1323","name":"Abercarn"},{"id":"350008","latitude":"53.289","longitude":"-3.8456","name":"Aberconwy House"},{"id":"350012","latitude":"57.145","longitude":"-2.1432","name":"Aberdeen Youth Hostel"},{"id":"350014","latitude":"52.5437","longitude":"-4.0449","name":"Aberdovey"},{"id":"350020","latitude":"51.7313","longitude":"-3.1336","name":"Abertillery"},{"id":"350021","latitude":"52.415","longitude":"-4.0817","name":"Aberystwyth"},{"id":"350023","latitude":"53.7534","longitude":"-2.3707","name":"Accrington"},{"id":"350028","latitude":"58.1699","longitude":"-5.3","name":"Achmelvich Youth Hostel"},{"id":"350029","latitude":"57.1825","longitude":"-5.1542","name":"A'Chralaig"},{"id":"350038","latitude":"53.6108","longitude":"-2.6049","name":"Adlington"},{"id":"350039","latitude":"51.5322","longitude":"0.7199","name":"Adventure Island"},{"id":"350042","latitude":"55.1954","longitude":"-3.5944","name":"Ae Mountain Bike Trail Centre"},{"id":"350046","latitude":"53.4791","longitude":"-2.9359","name":"Aintree"},{"id":"350049","latitude":"52.2149","longitude":"-1.8662","name":"Alcester"},{"id":"350053","latitude":"52.4487","longitude":"-1.4706","name":"Alderman's Green"},{"id":"350055","latitude":"52.6057","longitude":"-1.9143","name":"Aldridge"},{"id":"350065","latitude":"52.4241","longitude":"-1.565","name":"Allesley"},{"id":"350070","latitude":"54.8121","longitude":"-2.4372","name":"Alston"},{"id":"350071","latitude":"54.8052","longitude":"-2.4369","name":"Alston Youth Hostel"},{"id":"350073","latitude":"52.2815","longitude":"-1.0006","name":"Althorp House"},{"id":"350075","latitude":"53.3899","longitude":"-2.3495","name":"Altrincham"},{"id":"310013","latitude":"53.479","longitude":"-2.2465","name":"Manchester"},{"id":"310167","latitude":"52.1933","longitude":"-2.2202","name":"Worcester"},{"id":"310181","latitude":"51.0162","longitude":"-4.2055","name":"Bideford"},{"id":"324052","latitude":"52.9846","longitude":"-1.985","name":"Cheadle (Staffordshire)"},{"id":"3134","latitude":"55.907","longitude":"-4.533","name":"Glasgow\/Bishopton"},{"id":"3162","latitude":"55.311","longitude":"-3.206","name":"Eskdalemuir"},{"id":"3385","latitude":"53.473","longitude":"0.154","name":"Donna Nook"},{"id":"310240","latitude":"51.3606","longitude":"1.0259","name":"Whitstable"},{"id":"99016","latitude":"58.233","longitude":"-3.917","name":"Kinbrace"},{"id":"354377","latitude":"51.509","longitude":"-0.029","name":"Excel"},{"id":"352193","latitude":"58.0223","longitude":"-4.401","name":"Lairg"},{"id":"352198","latitude":"51.5075","longitude":"-1.5301","name":"Lambourn"},{"id":"352205","latitude":"50.0641","longitude":"-5.709","name":"Land's End"},{"id":"352207","latitude":"50.1134","longitude":"-5.6913","name":"Land's End Youth Hostel"},{"id":"352209","latitude":"54.4374","longitude":"-3.0206","name":"Langdale Youth Hostel"},{"id":"352211","latitude":"55.153","longitude":"-2.9975","name":"Langholm"},{"id":"352213","latitude":"51.0377","longitude":"-2.8274","name":"Langport"},{"id":"352214","latitude":"53.5032","longitude":"-1.6769","name":"Langsett Youth Hostel"},{"id":"352217","latitude":"52.5336","longitude":"-0.9453","name":"Langton Hall"},{"id":"352218","latitude":"50.4402","longitude":"-4.691","name":"Lanhydrock"},{"id":"352223","latitude":"50.9497","longitude":"-2.0747","name":"Larmer Tree Gardens"},{"id":"352224","latitude":"55.7229","longitude":"-2.7551","name":"Lauder"},{"id":"352232","latitude":"58.3753","longitude":"-5.0153","name":"Laxford Bridge"},{"id":"352241","latitude":"53.8011","longitude":"-1.547","name":"Leeds"},{"id":"352244","latitude":"53.1089","longitude":"-2.0219","name":"Leek"},{"id":"352248","latitude":"51.4632","longitude":"-0.6549","name":"Legoland Windsor"},{"id":"352249","latitude":"52.6201","longitude":"-1.1407","name":"Leicester City F.C."},{"id":"352250","latitude":"52.6225","longitude":"-1.2225","name":"Leicester Forest East"},{"id":"352255","latitude":"57.3584","longitude":"-2.761","name":"Leith Hall Garden And Estate"},{"id":"352259","latitude":"52.9382","longitude":"-1.2052","name":"Lenton Abbey"},{"id":"352261","latitude":"51.0193","longitude":"-0.2534","name":"Leonardslee Gardens"},{"id":"352265","latitude":"55.0706","longitude":"-6.5365","name":"Leslie Hill Open Farm & Gardens"},{"id":"352268","latitude":"51.9792","longitude":"-0.2208","name":"Letchworth Garden City"},{"id":"352271","latitude":"54.2573","longitude":"-2.7761","name":"Levens Hall"},{"id":"352272","latitude":"53.4509","longitude":"-2.1913","name":"Levenshulme"},{"id":"352274","latitude":"50.8734","longitude":"0.0104","name":"Lewes"},{"id":"352293","latitude":"52.0553","longitude":"-0.7703","name":"Linford Wood"},{"id":"352294","latitude":"51.1674","longitude":"-0.0094","name":"Lingfield Park Racecourse"},{"id":"352296","latitude":"52.3485","longitude":"1.4269","name":"Linstead Parva"},{"id":"352299","latitude":"54.3167","longitude":"-7.5352","name":"Lisbellaw"},{"id":"352304","latitude":"53.47","longitude":"-2.9936","name":"Litherland"},{"id":"352305","latitude":"53.4879","longitude":"-2.3189","name":"Little Bolton"},{"id":"352306","latitude":"52.481","longitude":"-1.8248","name":"Little Bromwich"},{"id":"352307","latitude":"53.784","longitude":"-1.7835","name":"Little Horton"},{"id":"352308","latitude":"51.9687","longitude":"-0.8485","name":"Little Horwood"},{"id":"352316","latitude":"50.7073","longitude":"-2.6367","name":"Litton Cheney Youth Hostel"},{"id":"352317","latitude":"53.4312","longitude":"-2.9563","name":"Liverpool F.C."},{"id":"352328","latitude":"53.3054","longitude":"-4.1478","name":"Llanddona"},{"id":"352337","latitude":"51.6805","longitude":"-4.159","name":"Llanelli"},{"id":"352340","latitude":"52.7659","longitude":"-3.2745","name":"Llanfyllin"},{"id":"352343","latitude":"52.9616","longitude":"-3.1394","name":"Llangollen Youth Hostel"},{"id":"352344","latitude":"51.9098","longitude":"-4.736","name":"Llangolman"},{"id":"352361","latitude":"51.8826","longitude":"-3.7019","name":"Llyn Y Fan Fawr"},{"id":"352363","latitude":"58.239","longitude":"-6.2753","name":"Loch A' Tuath"},{"id":"352367","latitude":"55.9063","longitude":"-5.6248","name":"Loch Caolisport"},{"id":"352368","latitude":"57.3829","longitude":"-5.49","name":"Loch Carron"},{"id":"352369","latitude":"57.242","longitude":"-5.4777","name":"Loch Duich"},{"id":"352372","latitude":"57.1575","longitude":"-5.9693","name":"Loch Eishort"},{"id":"352379","latitude":"56.0168","longitude":"-4.625","name":"Loch Lomond Youth Hostel"},{"id":"352380","latitude":"56.1351","longitude":"-4.8214","name":"Loch Long"},{"id":"352386","latitude":"56.7662","longitude":"-4.6714","name":"Loch Ossian Youth Hostel"},{"id":"352394","latitude":"56.5117","longitude":"-6.2449","name":"Loch Tuath"},{"id":"352395","latitude":"56.3888","longitude":"-4.2848","name":"Lochearnhead"},{"id":"352402","latitude":"51.4863","longitude":"-2.5679","name":"Lockleaze"},{"id":"352403","latitude":"54.3016","longitude":"-0.6989","name":"Lockton Youth Hostel"},{"id":"352404","latitude":"50.324","longitude":"-3.8013","name":"Loddiswell"},{"id":"352408","latitude":"54.7354","longitude":"-4.9573","name":"Logan Botanic Garden"},{"id":"352410","latitude":"50.9516","longitude":"0.9454","name":"London Ashford Airport"},{"id":"352414","latitude":"51.1511","longitude":"-0.1768","name":"London Gatwick Airport"},{"id":"352420","latitude":"50.5771","longitude":"-4.8351","name":"Long Cross Victorian Gardens"},{"id":"352422","latitude":"52.0739","longitude":"0.718","name":"Long Melford"},{"id":"352423","latitude":"52.4871","longitude":"1.239","name":"Long Stratton"},{"id":"352428","latitude":"53.0454","longitude":"-2.2252","name":"Longbridge Hayes"},{"id":"352430","latitude":"50.7236","longitude":"-1.9777","name":"Longfleet"},{"id":"352441","latitude":"50.2867","longitude":"-4.8137","name":"Lost Gardens Of Heligan"},{"id":"352445","latitude":"55.6286","longitude":"-4.3794","name":"Loudon Castle Park"},{"id":"352446","latitude":"54.6132","longitude":"-6.4173","name":"Lough Neagh"},{"id":"352453","latitude":"54.9545","longitude":"-1.6271","name":"Low Team"},{"id":"352459","latitude":"52.3629","longitude":"-2.7087","name":"Ludlow Youth Hostel"},{"id":"352461","latitude":"50.6215","longitude":"-2.2412","name":"Lulworth Cove Youth Hostel"},{"id":"352466","latitude":"52.4556","longitude":"-1.1976","name":"Lutterworth"},{"id":"352468","latitude":"50.9507","longitude":"0.909","name":"Lydd"},{"id":"352471","latitude":"51.7256","longitude":"-2.544","name":"Lydney Park"},{"id":"352482","latitude":"56.5057","longitude":"-5.6244","name":"Lynn Of Morven"},{"id":"352485","latitude":"53.7498","longitude":"-3.031","name":"Lytham St. Anne's"},{"id":"352490","latitude":"51.5012","longitude":"-3.193","name":"Maendy"},{"id":"352492","latitude":"51.6082","longitude":"-3.6592","name":"Maesteg"},{"id":"352493","latitude":"54.8441","longitude":"-6.6727","name":"Maghera"},{"id":"350079","latitude":"53.8632","longitude":"-1.5398","name":"Alwoodley"},{"id":"350080","latitude":"56.6259","longitude":"-3.2254","name":"Alyth"},{"id":"350082","latitude":"56.7428","longitude":"-4.9823","name":"Am Bodach"},{"id":"350090","latitude":"56.859","longitude":"-4.2929","name":"A'Mharconaich"},{"id":"350099","latitude":"56.9345","longitude":"-3.7491","name":"An Sgarsoch"},{"id":"350100","latitude":"56.9055","longitude":"-3.51","name":"An Socach (Glen Ey)"},{"id":"350107","latitude":"52.2377","longitude":"0.2402","name":"Anglesey Abbey"},{"id":"350114","latitude":"54.7193","longitude":"-6.2069","name":"Antrim"},{"id":"350118","latitude":"56.8348","longitude":"-4.5266","name":"Aonach Beag (Highland)"},{"id":"350121","latitude":"53.8338","longitude":"-1.7086","name":"Apperley Bridge"},{"id":"350123","latitude":"50.9859","longitude":"-3.3237","name":"Appley"},{"id":"350125","latitude":"56.8664","longitude":"-2.3333","name":"Arbuthnott House"},{"id":"350131","latitude":"56.0226","longitude":"-5.778","name":"Ardlussa"},{"id":"350139","latitude":"51.1445","longitude":"-3.9894","name":"Arlington Court"},{"id":"350145","latitude":"53.5369","longitude":"-1.0512","name":"Armthorpe"},{"id":"350147","latitude":"51.439","longitude":"-2.5613","name":"Arno's Vale"},{"id":"350151","latitude":"50.8547","longitude":"-0.5536","name":"Arundel"},{"id":"350155","latitude":"53.0163","longitude":"-1.7307","name":"Ashbourne"},{"id":"350156","latitude":"50.5153","longitude":"-3.7502","name":"Ashburton"},{"id":"350157","latitude":"52.7489","longitude":"-1.4671","name":"Ashby De La Zouch"},{"id":"350161","latitude":"53.4867","longitude":"-2.6412","name":"Ashton-In-Makerfield"},{"id":"350167","latitude":"53.6064","longitude":"-2.428","name":"Astley Bridge"},{"id":"350169","latitude":"52.5095","longitude":"-1.8838","name":"Aston Villa F.C."},{"id":"350170","latitude":"52.5763","longitude":"-1.5423","name":"Atherstone"},{"id":"350173","latitude":"52.584","longitude":"-1.4811","name":"Atterton"},{"id":"350179","latitude":"54.4286","longitude":"-7.1312","name":"Augher"},{"id":"350183","latitude":"51.429","longitude":"-1.8495","name":"Avebury"},{"id":"350187","latitude":"51.326","longitude":"-2.8093","name":"Avon Ski Centre"},{"id":"350193","latitude":"55.465","longitude":"-4.6073","name":"Ayr Racecourse"},{"id":"350207","latitude":"53.9562","longitude":"-0.531","name":"Bainton"},{"id":"350212","latitude":"51.9888","longitude":"-0.1877","name":"Baldock"},{"id":"350217","latitude":"57.0539","longitude":"-3.0424","name":"Ballater Ski Slope"},{"id":"350222","latitude":"54.8635","longitude":"-6.2777","name":"Ballymena"},{"id":"352496","latitude":"54.5133","longitude":"-6.5773","name":"Maghery Country Park"},{"id":"352498","latitude":"54.0619","longitude":"-2.1458","name":"Malham Youth Hostel"},{"id":"352501","latitude":"52.5958","longitude":"-1.3389","name":"Mallory Park"},{"id":"352504","latitude":"53.4224","longitude":"-1.1996","name":"Maltby"},{"id":"352508","latitude":"53.3577","longitude":"-2.2668","name":"Manchester Airport"},{"id":"352509","latitude":"53.4835","longitude":"-2.2041","name":"Manchester City F.C."},{"id":"352512","latitude":"52.5565","longitude":"-1.8229","name":"Maney"},{"id":"352513","latitude":"51.485","longitude":"-2.5113","name":"Mangotsfield"},{"id":"352514","latitude":"53.7101","longitude":"-2.0591","name":"Mankinholes Youth Hostel"},{"id":"352530","latitude":"52.5514","longitude":"0.0903","name":"March"},{"id":"352534","latitude":"52.6231","longitude":"-1.4063","name":"Market Bosworth"},{"id":"352547","latitude":"53.3971","longitude":"-2.0602","name":"Marple"},{"id":"352556","latitude":"51.1158","longitude":"-4.0827","name":"Marwood Hill Gardens"},{"id":"352559","latitude":"54.7143","longitude":"-3.4936","name":"Maryport"},{"id":"352560","latitude":"54.2232","longitude":"-1.6542","name":"Masham"},{"id":"352568","latitude":"53.0246","longitude":"-2.2147","name":"May Bank"},{"id":"352577","latitude":"56.5666","longitude":"-4.2587","name":"Meall A' Choire Leith"},{"id":"352581","latitude":"56.9616","longitude":"-4.112","name":"Meall Chuaich"},{"id":"352585","latitude":"56.635","longitude":"-4.198","name":"Meall Garbh (968m)"},{"id":"352591","latitude":"56.9895","longitude":"-4.928","name":"Meall Na Teanga"},{"id":"352597","latitude":"53.1511","longitude":"-2.0236","name":"Meerbrook Youth Hostel"},{"id":"352600","latitude":"52.9772","longitude":"-2.1014","name":"Meir"},{"id":"352605","latitude":"55.5986","longitude":"-2.7204","name":"Melrose"},{"id":"352609","latitude":"53.1593","longitude":"-4.2664","name":"Menai Strait"},{"id":"352617","latitude":"53.4928","longitude":"-1.2789","name":"Mexborough"},{"id":"352620","latitude":"60.6004","longitude":"-1.0664","name":"Mid Yell"},{"id":"352625","latitude":"53.7477","longitude":"-1.5239","name":"Middleton (West Yorkshire)"},{"id":"352630","latitude":"55.8812","longitude":"-3.2168","name":"Midlothian Ski Centre"},{"id":"352636","latitude":"55.2112","longitude":"-6.5227","name":"Mill Rest Youth Hostel"},{"id":"352637","latitude":"53.4909","longitude":"-2.0305","name":"Millbrook (Greater Manchester)"},{"id":"352638","latitude":"50.9158","longitude":"-1.4484","name":"Millbrook (Southampton)"},{"id":"350232","latitude":"53.2271","longitude":"-4.128","name":"Bangor (Gwynedd)"},{"id":"350234","latitude":"54.6509","longitude":"-5.6662","name":"Bangor Castle"},{"id":"350235","latitude":"53.2292","longitude":"-4.1134","name":"Bangor Youth Hostel"},{"id":"350239","latitude":"56.0918","longitude":"-3.907","name":"Bannockburn"},{"id":"350242","latitude":"53.5118","longitude":"-2.1071","name":"Bardsley"},{"id":"350243","latitude":"55.2651","longitude":"-4.7462","name":"Bargany Gardens"},{"id":"350244","latitude":"51.6845","longitude":"-3.2284","name":"Bargoed"},{"id":"350246","latitude":"52.0272","longitude":"0.0368","name":"Barley"},{"id":"350249","latitude":"54.5451","longitude":"-1.9222","name":"Barnard Castle"},{"id":"350259","latitude":"52.084","longitude":"0.3116","name":"Bartlow"},{"id":"350261","latitude":"53.6864","longitude":"-0.4417","name":"Barton-Upon-Humber"},{"id":"350267","latitude":"51.3736","longitude":"-2.3412","name":"Bath Youth Hostel"},{"id":"350269","latitude":"53.7168","longitude":"-1.6336","name":"Batley"},{"id":"350270","latitude":"51.9996","longitude":"-1.7343","name":"Batsford Arboretum"},{"id":"350271","latitude":"55.821","longitude":"-4.276","name":"Battlefield"},{"id":"350279","latitude":"57.4836","longitude":"-4.459","name":"Beauly"},{"id":"350281","latitude":"53.2656","longitude":"-4.0907","name":"Beaumaris"},{"id":"350286","latitude":"51.5145","longitude":"0.0582","name":"Becton"},{"id":"350290","latitude":"51.0751","longitude":"0.453","name":"Bedgebury"},{"id":"350292","latitude":"50.8541","longitude":"-1.0025","name":"Bedhampton"},{"id":"350296","latitude":"52.481","longitude":"-1.4674","name":"Bedworth"},{"id":"350299","latitude":"52.9236","longitude":"-1.2109","name":"Beeston (Nottinghamshire)"},{"id":"350300","latitude":"53.7738","longitude":"-1.5636","name":"Beeston (West Yorkshire)"},{"id":"350310","latitude":"56.3304","longitude":"-4.6039","name":"Beinn A' Chroin"},{"id":"350313","latitude":"56.8137","longitude":"-4.4284","name":"Beinn Bheoil"},{"id":"350317","latitude":"56.3252","longitude":"-4.6457","name":"Beinn Chabhair"},{"id":"350323","latitude":"56.4502","longitude":"-5.028","name":"Beinn Eunaich"},{"id":"350330","latitude":"56.8941","longitude":"-3.5628","name":"Beinn Iutharn Mhor"},{"id":"350331","latitude":"57.5163","longitude":"-5.4006","name":"Beinn Liath Mhor"},{"id":"350332","latitude":"57.7059","longitude":"-4.9857","name":"Beinn Liath Mhor Fannaich"},{"id":"350336","latitude":"56.519","longitude":"-5.0127","name":"Beinn Nan Aighenan"},{"id":"350337","latitude":"56.2207","longitude":"-4.7853","name":"Beinn Narnain"},{"id":"350350","latitude":"52.6576","longitude":"-1.1204","name":"Belgrave"},{"id":"350351","latitude":"56.001","longitude":"-2.549","name":"Belhaven Bay"},{"id":"350354","latitude":"53.7632","longitude":"-1.5234","name":"Belle Isle"},{"id":"350356","latitude":"50.5768","longitude":"-3.903","name":"Bellever Youth Hostel"},{"id":"350369","latitude":"58.4136","longitude":"-4.6049","name":"Ben Hope"},{"id":"350375","latitude":"56.3877","longitude":"-4.5399","name":"Ben More (Stirling)"},{"id":"350379","latitude":"56.5365","longitude":"-5.0492","name":"Ben Starav"},{"id":"352651","latitude":"51.2038","longitude":"-3.4799","name":"Minehead"},{"id":"352652","latitude":"51.1918","longitude":"-3.474","name":"Minehead Youth Hostel"},{"id":"352653","latitude":"54.9647","longitude":"-4.4696","name":"Minnigaff Youth Hostel"},{"id":"352657","latitude":"53.6799","longitude":"-1.6952","name":"Mirfield"},{"id":"352667","latitude":"50.9509","longitude":"-2.7108","name":"Montacute House"},{"id":"352670","latitude":"53.8321","longitude":"-1.7955","name":"Moor Head"},{"id":"352671","latitude":"53.7504","longitude":"-1.7659","name":"Moor Side"},{"id":"352675","latitude":"57.6067","longitude":"-3.0921","name":"Moray Monster Trails Mountain Bike Trail Centre"},{"id":"352678","latitude":"54.074","longitude":"-2.8636","name":"Morecambe"},{"id":"352679","latitude":"55.9105","longitude":"-3.1272","name":"Moredun"},{"id":"352680","latitude":"53.4003","longitude":"-3.1098","name":"Moreton"},{"id":"352683","latitude":"53.7443","longitude":"-1.5965","name":"Morley"},{"id":"352685","latitude":"55.1687","longitude":"-1.6859","name":"Morpeth"},{"id":"352687","latitude":"53.3272","longitude":"-1.3596","name":"Mosborough"},{"id":"352691","latitude":"53.557","longitude":"-2.4011","name":"Moses Gate"},{"id":"352697","latitude":"51.0254","longitude":"-2.2133","name":"Motcombe"},{"id":"352704","latitude":"51.6812","longitude":"-3.3719","name":"Mountain Ash"},{"id":"352708","latitude":"51.536","longitude":"0.7396","name":"Mr. B's Amusements Southend-On-Sea"},{"id":"352715","latitude":"55.5234","longitude":"-4.0651","name":"Muirkirk"},{"id":"352720","latitude":"57.2848","longitude":"-5.1855","name":"Mullach Na Dheiragain"},{"id":"352728","latitude":"50.761","longitude":"-1.8642","name":"Muscliff"},{"id":"352739","latitude":"53.0669","longitude":"-2.5227","name":"Nantwich"},{"id":"352754","latitude":"53.6696","longitude":"-1.7975","name":"Netheroyd Hill"},{"id":"352758","latitude":"51.3494","longitude":"-0.0142","name":"New Addington"},{"id":"352760","latitude":"53.1032","longitude":"-0.044","name":"New Bolingbroke"},{"id":"352762","latitude":"53.4379","longitude":"-3.0421","name":"New Brighton (Merseyside)"},{"id":"352769","latitude":"53.3616","longitude":"-1.9993","name":"New Mills"},{"id":"352772","latitude":"53.2081","longitude":"-1.0107","name":"New Ollerton"},{"id":"352773","latitude":"53.4398","longitude":"-3.0539","name":"New Palace And Adventureland New Brighton"},{"id":"352774","latitude":"52.6465","longitude":"-1.1781","name":"New Parks"},{"id":"352776","latitude":"52.2152","longitude":"-4.3579","name":"New Quay"},{"id":"352779","latitude":"51.8452","longitude":"1.2765","name":"New Walton Pier"},{"id":"352783","latitude":"51.6648","longitude":"-3.1428","name":"Newbridge"},{"id":"350380","latitude":"56.2497","longitude":"-4.778","name":"Ben Vane"},{"id":"350381","latitude":"56.2746","longitude":"-4.7515","name":"Ben Vorlich (Argyll & Bute)"},{"id":"350384","latitude":"54.0202","longitude":"-1.2117","name":"Beningbrough Hall"},{"id":"350389","latitude":"53.5441","longitude":"-1.1446","name":"Bentley (South Yorkshire)"},{"id":"350390","latitude":"52.5854","longitude":"-2.0222","name":"Bentley (West Midlands)"},{"id":"350393","latitude":"53.3551","longitude":"-1.5277","name":"Bents Green"},{"id":"350399","latitude":"57.7196","longitude":"-7.1577","name":"Berneray Youth Hostel"},{"id":"350406","latitude":"51.1288","longitude":"0.7557","name":"Bethersden"},{"id":"350407","latitude":"53.1787","longitude":"-4.0576","name":"Bethesda"},{"id":"350410","latitude":"53.8498","longitude":"-0.4576","name":"Beverley Racecourse"},{"id":"350413","latitude":"51.4414","longitude":"0.1487","name":"Bexley"},{"id":"350417","latitude":"53.1189","longitude":"-2.1702","name":"Biddulph"},{"id":"350418","latitude":"53.1296","longitude":"-2.1595","name":"Biddulph Grange Gardens"},{"id":"350426","latitude":"51.3116","longitude":"0.0344","name":"Biggin Hill"},{"id":"350431","latitude":"51.0224","longitude":"-0.4499","name":"Billingshurst"},{"id":"350433","latitude":"53.4282","longitude":"-0.1786","name":"Binbrook"},{"id":"350447","latitude":"52.4533","longitude":"-1.7357","name":"Birmingham International Airport"},{"id":"350450","latitude":"53.7294","longitude":"-1.6611","name":"Birstall Smithies"},{"id":"350453","latitude":"51.5583","longitude":"-0.7758","name":"Bisham Abbey National Sports Centre"},{"id":"350465","latitude":"54.5011","longitude":"-3.2435","name":"Black Sail Youth Hostel"},{"id":"350466","latitude":"50.9703","longitude":"0.1707","name":"Blackboys Youth Hostel"},{"id":"350468","latitude":"53.7294","longitude":"-2.4874","name":"Blackburn Rovers F.C."},{"id":"350470","latitude":"50.5821","longitude":"-1.3078","name":"Blackgang Chine"},{"id":"350474","latitude":"53.8056","longitude":"-3.0479","name":"Blackpool F.C."},{"id":"350478","latitude":"51.6677","longitude":"-3.1954","name":"Blackwood"},{"id":"350483","latitude":"56.055","longitude":"-4.7326","name":"Blairnairn"},{"id":"350484","latitude":"54.9913","longitude":"-1.6567","name":"Blakelaw"},{"id":"350489","latitude":"55.7939","longitude":"-4.0936","name":"Blantyre"},{"id":"350496","latitude":"52.4029","longitude":"-1.8061","name":"Blossomfield"},{"id":"350502","latitude":"53.2327","longitude":"-3.7955","name":"Bodnant Gardens"},{"id":"350512","latitude":"56.0172","longitude":"-3.607","name":"Bo'Ness"},{"id":"350515","latitude":"51.0239","longitude":"-0.1291","name":"Borde Hill Garden"},{"id":"350518","latitude":"54.5186","longitude":"-3.1494","name":"Borrowdale Youth Hostel"},{"id":"350521","latitude":"52.4963","longitude":"-4.0496","name":"Borth Youth Hostel"},{"id":"350523","latitude":"53.0329","longitude":"0.2982","name":"Boston Deeps"},{"id":"352791","latitude":"55.0308","longitude":"-1.614","name":"Newcastle Racecourse"},{"id":"352799","latitude":"51.0442","longitude":"0.9309","name":"Newchurch"},{"id":"352800","latitude":"51.9289","longitude":"-2.4032","name":"Newent"},{"id":"352801","latitude":"51.8506","longitude":"-5.1279","name":"Newgale"},{"id":"352808","latitude":"52.4455","longitude":"-1.2899","name":"Newnham Paddox Art Park"},{"id":"352815","latitude":"56.4405","longitude":"-2.9392","name":"Newport-On-Tay"},{"id":"352817","latitude":"54.1707","longitude":"-6.3348","name":"Newry"},{"id":"352818","latitude":"53.0762","longitude":"-1.1839","name":"Newstead Abbey"},{"id":"352823","latitude":"50.5418","longitude":"-3.5927","name":"Newton Abbot Racecourse"},{"id":"352825","latitude":"53.4993","longitude":"-2.1832","name":"Newton Heath"},{"id":"352843","latitude":"53.6999","longitude":"-1.6914","name":"Norristhorpe"},{"id":"352852","latitude":"55.0107","longitude":"-1.4476","name":"North Shields"},{"id":"352858","latitude":"51.0394","longitude":"-4.212","name":"Northam"},{"id":"352859","latitude":"51.6649","longitude":"0.8379","name":"Northend"},{"id":"352864","latitude":"51.4406","longitude":"0.3386","name":"Northfleet"},{"id":"352866","latitude":"52.9775","longitude":"-2.2196","name":"Northwood (Staffordshire)"},{"id":"352868","latitude":"54.1326","longitude":"-0.7817","name":"Norton (North Yorkshire)"},{"id":"352869","latitude":"53.3319","longitude":"-1.4673","name":"Norton (South Yorkshire)"},{"id":"352871","latitude":"54.18","longitude":"-1.5157","name":"Norton Conyers"},{"id":"352873","latitude":"53.3428","longitude":"-1.4727","name":"Norton Woodseats"},{"id":"352880","latitude":"52.9444","longitude":"-1.1026","name":"Nottingham Racecourse"},{"id":"352893","latitude":"53.3937","longitude":"-2.1243","name":"Offerton"},{"id":"352898","latitude":"53.4566","longitude":"-2.286","name":"Old Trafford Lancashire C.C.C."},{"id":"352899","latitude":"52.5046","longitude":"-2.0145","name":"Oldbury"},{"id":"352901","latitude":"55.8488","longitude":"-4.392","name":"Oldhall"},{"id":"352908","latitude":"54.9915","longitude":"-2.3842","name":"Once Brewed Youth Hostel"},{"id":"352915","latitude":"53.7991","longitude":"-1.5096","name":"Osmondthorpe"},{"id":"352917","latitude":"53.6809","longitude":"-1.5774","name":"Ossett"},{"id":"352921","latitude":"53.9056","longitude":"-1.6903","name":"Otley"},{"id":"352922","latitude":"50.7521","longitude":"-3.2791","name":"Ottery St. Mary"},{"id":"352925","latitude":"60.4257","longitude":"-0.7467","name":"Out Skerries Airstrip"},{"id":"352927","latitude":"53.743","longitude":"-1.8764","name":"Ovenden"},{"id":"352933","latitude":"51.7629","longitude":"-1.2295","name":"Oxford Youth Hostel"},{"id":"352937","latitude":"53.6477","longitude":"-1.8133","name":"Paddock"},{"id":"350529","latitude":"55.8062","longitude":"-4.0714","name":"Bothwell"},{"id":"350530","latitude":"50.9148","longitude":"-1.2692","name":"Botley"},{"id":"350531","latitude":"52.4234","longitude":"-0.6729","name":"Boughton House"},{"id":"350539","latitude":"53.378","longitude":"-2.3655","name":"Bowgreen"},{"id":"350543","latitude":"51.4272","longitude":"-2.0377","name":"Bowood House & Gardens"},{"id":"350544","latitude":"51.757","longitude":"0.3874","name":"Boyton Cross"},{"id":"350545","latitude":"57.3603","longitude":"-6.4055","name":"Bracadale"},{"id":"350548","latitude":"51.4142","longitude":"-0.7821","name":"Bracknell Ski & Snowboard Centre"},{"id":"350549","latitude":"53.0594","longitude":"-2.1736","name":"Bradeley"},{"id":"350550","latitude":"52.6396","longitude":"0.8458","name":"Bradenham"},{"id":"350553","latitude":"53.4329","longitude":"-1.3743","name":"Bradgate"},{"id":"350554","latitude":"53.5745","longitude":"-2.3679","name":"Bradley Fold"},{"id":"350560","latitude":"57.0749","longitude":"-3.7288","name":"Braeriach"},{"id":"350562","latitude":"56.8332","longitude":"-3.7263","name":"Braigh Coire Chruinn-Bhalgain"},{"id":"350567","latitude":"54.9425","longitude":"-2.7349","name":"Brampton"},{"id":"350572","latitude":"56.3929","longitude":"-3.4085","name":"Branklyn Gardens"},{"id":"350577","latitude":"52.6177","longitude":"-1.1764","name":"Braunstone"},{"id":"350582","latitude":"53.5825","longitude":"-2.3962","name":"Breightmet"},{"id":"350585","latitude":"51.5927","longitude":"0.2935","name":"Brentwood Ski Centre"},{"id":"350587","latitude":"53.297","longitude":"-1.7046","name":"Bretton Youth Hostel"},{"id":"350592","latitude":"51.5039","longitude":"-3.5757","name":"Bridgend (Bridgend)"},{"id":"350597","latitude":"54.0851","longitude":"-0.1971","name":"Bridlington"},{"id":"350605","latitude":"53.3631","longitude":"-1.5001","name":"Brincliffe"},{"id":"350607","latitude":"53.4305","longitude":"-2.1303","name":"Brinnington"},{"id":"350608","latitude":"51.4319","longitude":"-2.5501","name":"Brislington"},{"id":"350609","latitude":"52.4775","longitude":"-2.0016","name":"Bristnall Fields"},{"id":"350611","latitude":"51.5177","longitude":"-2.5802","name":"Bristol Filton Airport"},{"id":"350612","latitude":"51.3829","longitude":"-2.714","name":"Bristol International Airport"},{"id":"350615","latitude":"51.6317","longitude":"-3.8231","name":"Briton Ferry"},{"id":"350617","latitude":"51.7853","longitude":"-5.0939","name":"Broad Haven Youth Hostel"},{"id":"350629","latitude":"50.8184","longitude":"-1.5743","name":"Brockenhurst"},{"id":"350638","latitude":"51.405","longitude":"0.1278","name":"Bromley Ski Centre"},{"id":"350649","latitude":"54.8938","longitude":"-6.2023","name":"Broughshane"},{"id":"350650","latitude":"52.0458","longitude":"-1.3934","name":"Broughton Castle"},{"id":"350651","latitude":"54.8372","longitude":"-4.0514","name":"Broughton House (Kirkcudbright)"},{"id":"350652","latitude":"54.2775","longitude":"-3.2099","name":"Broughton In Furness"},{"id":"350658","latitude":"53.1395","longitude":"-2.8411","name":"Bruera"},{"id":"350665","latitude":"56.1745","longitude":"-3.0293","name":"Buckhaven"},{"id":"350668","latitude":"50.6305","longitude":"-3.319","name":"Budleigh Salterton"},{"id":"350670","latitude":"52.4551","longitude":"1.4457","name":"Bungay"},{"id":"350677","latitude":"50.8238","longitude":"-1.6892","name":"Burley Youth Hostel"},{"id":"352944","latitude":"51.4818","longitude":"-1.0857","name":"Pangbourne"},{"id":"352952","latitude":"53.3831","longitude":"-1.448","name":"Park Hill"},{"id":"352954","latitude":"55.9197","longitude":"-4.4273","name":"Parkhall"},{"id":"352959","latitude":"55.8742","longitude":"-4.3092","name":"Partick"},{"id":"352962","latitude":"51.0354","longitude":"0.4322","name":"Pashley Manor Gardens"},{"id":"352963","latitude":"51.5357","longitude":"-2.5593","name":"Patchway"},{"id":"352966","latitude":"54.6953","longitude":"-6.0218","name":"Patterson's Spade Mill (Nt)"},{"id":"352969","latitude":"50.7927","longitude":"-0.0036","name":"Peacehaven"},{"id":"352973","latitude":"53.4745","longitude":"-2.3806","name":"Peel Green"},{"id":"352975","latitude":"50.365","longitude":"-4.5245","name":"Pelynt"},{"id":"352980","latitude":"51.4384","longitude":"-3.1722","name":"Penarth"},{"id":"352986","latitude":"50.8895","longitude":"-2.6818","name":"Pendomer"},{"id":"352987","latitude":"50.9221","longitude":"0.4109","name":"Penhurst"},{"id":"352993","latitude":"52.0523","longitude":"-4.377","name":"Penrhiw-Llan"},{"id":"352995","latitude":"52.5002","longitude":"-2.1336","name":"Pensnett"},{"id":"353002","latitude":"50.1193","longitude":"-5.5584","name":"Penzance Youth Hostel"}]}}"""

  private lazy val locationsIdTuples: Seq[(String,Int)] = {
    val locData = Try {
      val responseFuture = WS.url("http://datapoint.metoffice.gov.uk/public/data/val/wxfcs/all/json/sitelist")
        .setQueryParameter("key", metOfficeKey)
        .get
      responseFuture.get.getBody
    }.getOrElse(FALLBACK_LOCATIONS_DATA)
    val root = Json.parse(locData)
    val locations = (root \ "Locations" \ "Location").asOpt[List[Map[String, String]]].getOrElse(List())
    val sortedLocations = locations.map(x => (x("name"), x("id").toInt)).sortBy(_._1)
    sortedLocations
  }

  private lazy val idLookupMap: Map[String,Int] = {
    locationsIdTuples.toMap
  }

  private lazy val locations: Seq[String] = {
    locationsIdTuples.map(_._1)
  }

  private lazy val locationsJson: String = {
    val json = Json.toJson(locationsIdTuples.toMap)
    Json.stringify(json)
  }

  private val FALLBACK_WEATHER_DATA =
    """[
      | {"T":"20","U":"1","F":"18","G":"16","hours":"18","V":"EX","date":"2013-08-08Z","Pp":"10","H":"54","W":"7","D":"SSW","S":"9"},
      | {"T":"15","U":"0","F":"15","G":"7","hours":"21","V":"VG","date":"2013-08-08Z","Pp":"2","H":"73","W":"2","D":"SE","S":"0"},
      | {"T":"15","U":"0","F":"15","G":"7","hours":"0","V":"VG","date":"2013-08-09Z","Pp":"15","H":"77","W":"2","D":"SSE","S":"4"},
      | {"T":"15","U":"0","F":"15","G":"4","hours":"3","V":"GO","date":"2013-08-09Z","Pp":"19","H":"86","W":"7","D":"SE","S":"2"},
      | {"T":"15","U":"1","F":"14","G":"9","hours":"6","V":"GO","date":"2013-08-09Z","Pp":"8","H":"88","W":"7","D":"WSW","S":"7"},
      | {"T":"16","U":"2","F":"15","G":"18","hours":"9","V":"VG","date":"2013-08-09Z","Pp":"6","H":"81","W":"7","D":"W","S":"11"},
      | {"T":"18","U":"4","F":"15","G":"22","hours":"12","V":"VG","date":"2013-08-09Z","Pp":"15","H":"70","W":"7","D":"W","S":"13"},
      | {"T":"18","U":"3","F":"15","G":"27","hours":"15","V":"VG","date":"2013-08-09Z","Pp":"10","H":"61","W":"3","D":"W","S":"16"},
      | {"T":"17","U":"1","F":"14","G":"25","hours":"18","V":"VG","date":"2013-08-09Z","Pp":"1","H":"61","W":"3","D":"W","S":"13"},
      | {"T":"14","U":"0","F":"12","G":"22","hours":"21","V":"VG","date":"2013-08-09Z","Pp":"1","H":"70","W":"0","D":"W","S":"11"},
      | {"T":"12","U":"0","F":"10","G":"18","hours":"0","V":"VG","date":"2013-08-10Z","Pp":"1","H":"80","W":"0","D":"WSW","S":"9"},
      | {"T":"11","U":"0","F":"9","G":"16","hours":"3","V":"VG","date":"2013-08-10Z","Pp":"1","H":"87","W":"0","D":"WSW","S":"9"},
      | {"T":"11","U":"1","F":"10","G":"13","hours":"6","V":"GO","date":"2013-08-10Z","Pp":"1","H":"87","W":"1","D":"WSW","S":"7"},
      | {"T":"14","U":"2","F":"13","G":"16","hours":"9","V":"VG","date":"2013-08-10Z","Pp":"4","H":"72","W":"7","D":"WSW","S":"9"},
      | {"T":"16","U":"4","F":"14","G":"20","hours":"12","V":"VG","date":"2013-08-10Z","Pp":"9","H":"69","W":"7","D":"WSW","S":"9"},
      | {"T":"16","U":"2","F":"14","G":"20","hours":"15","V":"VG","date":"2013-08-10Z","Pp":"15","H":"71","W":"7","D":"WSW","S":"11"},
      | {"T":"15","U":"1","F":"14","G":"18","hours":"18","V":"VG","date":"2013-08-10Z","Pp":"14","H":"74","W":"7","D":"WSW","S":"9"},
      | {"T":"14","U":"0","F":"13","G":"13","hours":"21","V":"GO","date":"2013-08-10Z","Pp":"28","H":"81","W":"9","D":"SW","S":"7"},
      | {"T":"13","U":"0","F":"12","G":"16","hours":"0","V":"GO","date":"2013-08-11Z","Pp":"4","H":"89","W":"2","D":"SW","S":"9"},
      | {"T":"12","U":"0","F":"11","G":"18","hours":"3","V":"GO","date":"2013-08-11Z","Pp":"10","H":"90","W":"2","D":"WSW","S":"9"},
      | {"T":"12","U":"1","F":"11","G":"18","hours":"6","V":"GO","date":"2013-08-11Z","Pp":"3","H":"87","W":"3","D":"WSW","S":"11"},
      | {"T":"14","U":"2","F":"12","G":"25","hours":"9","V":"GO","date":"2013-08-11Z","Pp":"35","H":"79","W":"10","D":"WSW","S":"13"},
      | {"T":"16","U":"4","F":"13","G":"31","hours":"12","V":"VG","date":"2013-08-11Z","Pp":"39","H":"65","W":"10","D":"WSW","S":"16"},
      | {"T":"15","U":"2","F":"12","G":"29","hours":"15","V":"GO","date":"2013-08-11Z","Pp":"38","H":"71","W":"10","D":"WSW","S":"16"},
      | {"T":"14","U":"1","F":"11","G":"31","hours":"18","V":"VG","date":"2013-08-11Z","Pp":"9","H":"72","W":"3","D":"WSW","S":"16"},
      | {"T":"12","U":"0","F":"10","G":"25","hours":"21","V":"VG","date":"2013-08-11Z","Pp":"10","H":"82","W":"0","D":"WSW","S":"13"},
      | {"T":"12","U":"0","F":"9","G":"25","hours":"0","V":"VG","date":"2013-08-12Z","Pp":"1","H":"87","W":"2","D":"WSW","S":"13"},
      | {"T":"11","U":"0","F":"9","G":"25","hours":"3","V":"VG","date":"2013-08-12Z","Pp":"0","H":"86","W":"0","D":"W","S":"13"},
      | {"T":"12","U":"1","F":"9","G":"22","hours":"6","V":"VG","date":"2013-08-12Z","Pp":"0","H":"84","W":"3","D":"W","S":"13"},
      | {"T":"14","U":"2","F":"11","G":"27","hours":"9","V":"VG","date":"2013-08-12Z","Pp":"11","H":"72","W":"3","D":"W","S":"16"},
      | {"T":"15","U":"4","F":"13","G":"29","hours":"12","V":"VG","date":"2013-08-12Z","Pp":"13","H":"63","W":"3","D":"WNW","S":"16"},
      | {"T":"16","U":"2","F":"13","G":"27","hours":"15","V":"VG","date":"2013-08-12Z","Pp":"17","H":"61","W":"7","D":"WNW","S":"16"},
      | {"T":"15","U":"1","F":"13","G":"25","hours":"18","V":"VG","date":"2013-08-12Z","Pp":"12","H":"65","W":"3","D":"WNW","S":"13"},
      | {"T":"13","U":"0","F":"11","G":"20","hours":"21","V":"VG","date":"2013-08-12Z","Pp":"14","H":"75","W":"7","D":"W","S":"11"}
      | ]""".stripMargin

  private def weatherForLocation(locationId: Int): String = {
    Try {
      val responseFuture = WS.url(s"http://datapoint.metoffice.gov.uk/public/data/val/wxfcs/all/json/$locationId")
         .setQueryParameter("res", "3hourly")
         .setQueryParameter("key", metOfficeKey)
         .get
       val root = Json.parse(responseFuture.get.getBody)
       val metadata: Map[String, JsValue] = (root \ "SiteRep" \ "DV").asOpt[Map[String, JsValue]].getOrElse(Map())
       val periods: List[Map[String, JsValue]] = (metadata("Location") \ "Period").asOpt[List[Map[String, JsValue]]].getOrElse(List())
       val data: List[Map[String, String]] = for {
         period <- periods
         rep <- period("Rep").asOpt[List[Map[String, String]]].getOrElse(List[Map[String,String]]())
       } yield {
         val combined = rep ++ Map("date" -> period("value").as[String])
         combined.keys.map {
           (key: String) =>
             val value = combined(key)
             key match {
               case "$" =>
                 val mins = value.toInt
                 val time = LocalTime.fromMillisOfDay(mins * 60 * 1000)
                 ("hours", time.getHourOfDay.toString)
               case x => (x, value)
             }
         }.toMap
       }
       val json = Json.toJson(data)
       Json.stringify(json)
    }.getOrElse(FALLBACK_WEATHER_DATA)
  }

  def index = Action {
    Ok(views.html.index(""))
  }

  def locationsFeed = Action {
    Ok(locationsJson)
  }

  def weatherFeed(locationId: Int) = Action {
    Ok(weatherForLocation(locationId))
  }

  def weatherFeedForLocation(location: String) = Action {
    Ok(weatherForLocation(idLookupMap(location)))
  }
  
}
